<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√©t√©o V√©lo ‚Äì Magny-le-Hongre</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;800&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0d1117;
    --card: #161b22;
    --card2: #1c2330;
    --border: rgba(255,255,255,0.06);
    --blue: #4fc3f7;
    --blue-dark: #0288d1;
    --green: #66bb6a;
    --orange: #ffa726;
    --red: #ef5350;
    --text: #e6edf3;
    --muted: #7d8590;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    font-family: 'Barlow', sans-serif;
    color: var(--text);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
  }

  .widget {
    width: 100%;
    max-width: 480px;
    animation: fadeIn 0.6s ease;
  }

  @keyframes fadeIn { from { opacity:0; transform: translateY(12px); } to { opacity:1; transform: translateY(0); } }

  /* HEADER */
  .header {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 16px 16px 0 0;
    padding: 20px 24px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    border-bottom: none;
  }

  .location {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.75rem;
    font-weight: 600;
    letter-spacing: 0.12em;
    text-transform: uppercase;
    color: var(--muted);
  }
  .location span { color: var(--blue); }

  .score-badge {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    font-weight: 700;
    letter-spacing: 0.1em;
    text-transform: uppercase;
    padding: 5px 12px;
    border-radius: 20px;
    background: rgba(102,187,106,0.15);
    color: var(--green);
    border: 1px solid rgba(102,187,106,0.3);
    transition: all 0.4s;
  }
  .score-badge.warn { background: rgba(255,167,38,0.15); color: var(--orange); border-color: rgba(255,167,38,0.3); }
  .score-badge.bad  { background: rgba(239,83,80,0.15);  color: var(--red);    border-color: rgba(239,83,80,0.3); }

  /* MAIN TEMP */
  .main-block {
    background: var(--card);
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
    padding: 8px 24px 20px;
    display: flex;
    align-items: flex-end;
    gap: 20px;
  }

  .temp-now {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 5rem;
    font-weight: 800;
    line-height: 1;
    color: var(--text);
  }
  .temp-now sup { font-size: 2rem; font-weight: 400; opacity: 0.6; vertical-align: super; }

  .temp-details {
    padding-bottom: 6px;
  }
  .temp-feels {
    font-size: 0.85rem;
    color: var(--muted);
  }
  .temp-feels strong { color: var(--text); }

  .weather-desc {
    font-size: 0.9rem;
    margin-top: 4px;
    color: var(--blue);
    font-weight: 500;
    text-transform: capitalize;
  }

  /* STATS GRID */
  .stats {
    background: var(--card);
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
    padding: 0 16px 16px;
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
  }

  .stat-card {
    background: var(--card2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 14px 16px;
  }

  .stat-label {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .stat-label svg { opacity: 0.5; }

  .stat-value {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.8rem;
    font-weight: 700;
    line-height: 1;
  }
  .stat-unit {
    font-size: 0.8rem;
    font-weight: 400;
    color: var(--muted);
    margin-left: 3px;
  }

  .wind-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 2px;
  }

  .arrow-wrap {
    width: 36px; height: 36px;
    border-radius: 50%;
    background: rgba(79,195,247,0.1);
    border: 1px solid rgba(79,195,247,0.2);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
  }
  .arrow-icon {
    font-size: 1.2rem;
    color: var(--blue);
    display: inline-block;
    transition: transform 0.8s cubic-bezier(.34,1.56,.64,1);
  }

  .wind-dir-label {
    font-size: 0.75rem;
    color: var(--muted);
    margin-top: 3px;
  }

  /* HOURLY */
  .hourly-header {
    background: var(--card);
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
    padding: 6px 24px 10px;
    border-top: 1px solid var(--border);
  }
  .hourly-title {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.65rem;
    font-weight: 700;
    letter-spacing: 0.14em;
    text-transform: uppercase;
    color: var(--muted);
  }

  .hourly-scroll {
    background: var(--card);
    border-left: 1px solid var(--border);
    border-right: 1px solid var(--border);
    padding: 0 16px 16px;
    overflow-x: auto;
    scrollbar-width: thin;
    scrollbar-color: var(--border) transparent;
  }

  .hourly-track {
    display: flex;
    gap: 8px;
    min-width: max-content;
  }

  .hour-card {
    background: var(--card2);
    border: 1px solid var(--border);
    border-radius: 12px;
    padding: 10px 12px;
    text-align: center;
    min-width: 68px;
    transition: border-color 0.2s;
  }
  .hour-card:hover { border-color: rgba(79,195,247,0.3); }
  .hour-card.now { border-color: rgba(79,195,247,0.5); background: rgba(79,195,247,0.06); }

  .hour-time {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 0.7rem;
    font-weight: 600;
    letter-spacing: 0.08em;
    color: var(--muted);
    margin-bottom: 6px;
  }
  .hour-card.now .hour-time { color: var(--blue); }

  .hour-temp {
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1.25rem;
    font-weight: 700;
    line-height: 1;
  }

  .hour-wind {
    font-size: 0.7rem;
    color: var(--muted);
    margin-top: 4px;
  }
  .hour-wind span { color: var(--blue); font-weight: 600; }

  .hour-rain {
    font-size: 0.7rem;
    color: var(--muted);
    margin-top: 3px;
  }
  .hour-rain.has-rain { color: #64b5f6; }

  /* FOOTER */
  .footer {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 0 0 16px 16px;
    border-top: none;
    padding: 10px 24px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .update-time {
    font-size: 0.7rem;
    color: var(--muted);
  }

  .advice {
    font-size: 0.75rem;
    font-weight: 500;
    color: var(--green);
  }
  .advice.warn { color: var(--orange); }
  .advice.bad  { color: var(--red); }

  .loading-state {
    text-align: center;
    padding: 40px;
    font-family: 'Barlow Condensed', sans-serif;
    font-size: 1rem;
    letter-spacing: 0.1em;
    color: var(--muted);
  }

  @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }
  .loading-dot { animation: pulse 1.4s infinite; }
  .loading-dot:nth-child(2) { animation-delay: 0.2s; }
  .loading-dot:nth-child(3) { animation-delay: 0.4s; }
</style>
</head>
<body>

<div class="widget" id="widget">
  <div class="loading-state">
    <span class="loading-dot">‚óè</span> <span class="loading-dot">‚óè</span> <span class="loading-dot">‚óè</span>
    <div style="margin-top:10px; font-size:0.8rem;">Chargement m√©t√©o...</div>
  </div>
</div>

<script>
(function() {
  // Magny-le-Hongre 77700
  const LAT = 48.8561;
  const LON = 2.8931;
  const CITY = "Magny-le-Hongre";

  const WIND_DIRS = ["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSO","SO","OSO","O","ONO","NO","NNO"];

  function degToDir(deg) {
    return WIND_DIRS[Math.round(deg / 22.5) % 16];
  }

  function getBikeScore(temp, windKmh, rain, feelsLike) {
    let score = 100;
    // Temp√©rature
    if (temp < 5)  score -= 30;
    else if (temp < 10) score -= 15;
    else if (temp > 35) score -= 20;
    // Vent
    if (windKmh > 50) score -= 35;
    else if (windKmh > 30) score -= 20;
    else if (windKmh > 20) score -= 10;
    // Pluie
    if (rain > 2) score -= 40;
    else if (rain > 0.5) score -= 20;
    else if (rain > 0) score -= 10;
    // Ressenti
    if (feelsLike < 3) score -= 15;

    if (score >= 75) return { label: "‚úì Id√©al pour rouler", cls: "good" };
    if (score >= 45) return { label: "‚ö† Conditions correctes", cls: "warn" };
    return { label: "‚úó D√©conseill√©", cls: "bad" };
  }

  function formatHour(isoStr) {
    const d = new Date(isoStr);
    return d.getHours().toString().padStart(2, '0') + "h";
  }

  function rainBar(mm) {
    if (mm === 0) return '<span>0 mm</span>';
    return `<span class="has-rain">üåß ${mm.toFixed(1)} mm</span>`;
  }

  async function loadWeather() {
    try {
      const url = `https://api.open-meteo.com/v1/forecast`
        + `?latitude=${LAT}&longitude=${LON}`
        + `&current=temperature_2m,apparent_temperature,precipitation,wind_speed_10m,wind_direction_10m,weathercode`
        + `&hourly=temperature_2m,apparent_temperature,precipitation,wind_speed_10m,wind_direction_10m`
        + `&wind_speed_unit=kmh`
        + `&timezone=Europe%2FParis`
        + `&forecast_days=2`;

      const r = await fetch(url);
      if (!r.ok) throw new Error("HTTP " + r.status);
      const d = await r.json();

      const c = d.current;
      const temp     = Math.round(c.temperature_2m);
      const feels    = Math.round(c.apparent_temperature);
      const wind     = Math.round(c.wind_speed_10m);
      const windDeg  = c.wind_direction_10m ?? 0;
      const rain     = c.precipitation ?? 0;
      const wcode    = c.weathercode ?? 0;

      const score = getBikeScore(temp, wind, rain, feels);
      const windDir = degToDir(windDeg);
      const desc = weatherDesc(wcode);

      // Pr√©visions horaires ‚Äî prochaines 12h
      const now = new Date();
      const nowHour = now.getHours();
      const times = d.hourly.time;
      const startIdx = times.findIndex(t => {
        const h = new Date(t);
        return h >= now;
      });

      let hoursHtml = '';
      for (let i = startIdx; i < startIdx + 12 && i < times.length; i++) {
        const isNow = i === startIdx;
        const hTemp  = Math.round(d.hourly.temperature_2m[i]);
        const hWind  = Math.round(d.hourly.wind_speed_10m[i]);
        const hRain  = d.hourly.precipitation[i] ?? 0;
        const hDir   = degToDir(d.hourly.wind_direction_10m[i] ?? 0);
        hoursHtml += `
          <div class="hour-card${isNow ? ' now' : ''}">
            <div class="hour-time">${isNow ? 'Maint.' : formatHour(times[i])}</div>
            <div class="hour-temp">${hTemp}¬∞</div>
            <div class="hour-wind"><span>${hWind}</span> km/h ${hDir}</div>
            <div class="hour-rain ${hRain > 0 ? 'has-rain' : ''}">${hRain > 0 ? 'üåß ' + hRain.toFixed(1) : '‚Äî mm'}</div>
          </div>`;
      }

      const html = `
        <div class="header">
          <div class="location">üìç <span>${CITY}</span> ¬∑ √éle-de-France</div>
          <div class="score-badge ${score.cls === 'good' ? '' : score.cls}">${score.label}</div>
        </div>

        <div class="main-block">
          <div class="temp-now">${temp}<sup>¬∞C</sup></div>
          <div class="temp-details">
            <div class="temp-feels">Ressenti <strong>${feels}¬∞C</strong></div>
            <div class="weather-desc">${desc}</div>
          </div>
        </div>

        <div class="stats">
          <div class="stat-card">
            <div class="stat-label">
              <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2v10m0 0a4 4 0 1 0 4 4"/><circle cx="12" cy="16" r="4"/></svg>
              Vent actuel
            </div>
            <div class="wind-row">
              <div class="arrow-wrap">
                <span class="arrow-icon" id="wind-arrow" style="transform: rotate(${windDeg}deg)">‚Üë</span>
              </div>
              <div>
                <div class="stat-value">${wind}<span class="stat-unit">km/h</span></div>
                <div class="wind-dir-label">${windDir}</div>
              </div>
            </div>
          </div>

          <div class="stat-card">
            <div class="stat-label">
              <svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2.69l5.66 5.66a8 8 0 1 1-11.31 0z"/></svg>
              Pluie (1h)
            </div>
            <div class="stat-value" style="color: ${rain > 0 ? '#64b5f6' : 'var(--text)'}">
              ${rain.toFixed(1)}<span class="stat-unit">mm</span>
            </div>
            <div style="font-size:0.72rem; color: var(--muted); margin-top: 4px;">
              ${rain === 0 ? 'Pas de pluie' : rain < 1 ? 'Bruine l√©g√®re' : rain < 3 ? 'Pluie mod√©r√©e' : 'Forte pluie'}
            </div>
          </div>
        </div>

        <div class="hourly-header">
          <div class="hourly-title">Pr√©visions ¬∑ 12 prochaines heures</div>
        </div>
        <div class="hourly-scroll">
          <div class="hourly-track">${hoursHtml}</div>
        </div>

        <div class="footer">
          <div class="update-time">Mise √† jour : ${new Date().toLocaleTimeString('fr-FR', {hour:'2-digit', minute:'2-digit'})}</div>
          <div class="advice ${score.cls === 'good' ? '' : score.cls}">${
            score.cls === 'good' ? 'üö¥ Route & VTT OK' :
            score.cls === 'warn' ? '‚ö° √âquipez-vous bien' :
            'üè† Restez au chaud'
          }</div>
        </div>
      `;

      document.getElementById('widget').innerHTML = html;

    } catch(e) {
      document.getElementById('widget').innerHTML = `
        <div class="loading-state">
          <div style="color:#ef5350">Erreur de chargement</div>
          <div style="font-size:0.75rem; margin-top:8px; color:var(--muted)">${e.message}</div>
        </div>`;
    }
  }

  function weatherDesc(code) {
    const map = {
      0: "Ciel d√©gag√©", 1: "Peu nuageux", 2: "Partiellement nuageux", 3: "Couvert",
      45: "Brouillard", 48: "Brouillard givrant",
      51: "Bruine l√©g√®re", 53: "Bruine mod√©r√©e", 55: "Bruine dense",
      61: "Pluie l√©g√®re", 63: "Pluie mod√©r√©e", 65: "Forte pluie",
      71: "Neige l√©g√®re", 73: "Neige mod√©r√©e", 75: "Forte neige",
      80: "Averses l√©g√®res", 81: "Averses", 82: "Fortes averses",
      95: "Orage", 96: "Orage avec gr√™le", 99: "Orage violent"
    };
    return map[code] || "Variable";
  }

  loadWeather();
  setInterval(loadWeather, 600000);
})();
</script>
</body>
</html>

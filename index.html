<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>M√©t√©o V√©lo ‚Äì Magny-le-Hongre</title>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;600;700;800&family=Barlow:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root{
    --card:#161b22;--card2:#1c2330;
    --border:rgba(255,255,255,0.06);
    --blue:#4fc3f7;--green:#66bb6a;--orange:#ffa726;--red:#ef5350;--yellow:#ffee58;
    --text:#e6edf3;--muted:#7d8590;
  }
  *{box-sizing:border-box;margin:0;padding:0;}
  html,body{background:transparent;font-family:'Barlow',sans-serif;color:var(--text);}
  body{padding:10px;}
  .widget{width:100%;max-width:480px;margin:auto;animation:fadeIn 0.6s ease;}
  @keyframes fadeIn{from{opacity:0;transform:translateY(12px);}to{opacity:1;transform:translateY(0);}}

  /* ALERTE */
  .alert-bar{border-radius:10px;padding:10px 14px;margin-bottom:8px;display:flex;align-items:flex-start;gap:10px;font-size:0.82rem;line-height:1.4;}
  .alert-bar.vert{background:rgba(102,187,106,0.12);border:1px solid rgba(102,187,106,0.3);color:var(--green);}
  .alert-bar.jaune{background:rgba(255,238,88,0.12);border:1px solid rgba(255,238,88,0.35);color:var(--yellow);}
  .alert-bar.orange{background:rgba(255,167,38,0.15);border:1px solid rgba(255,167,38,0.4);color:var(--orange);}
  .alert-bar.rouge{background:rgba(239,83,80,0.15);border:1px solid rgba(239,83,80,0.4);color:var(--red);}
  .alert-icon{font-size:1.1rem;flex-shrink:0;margin-top:1px;}
  .alert-text b{display:block;font-weight:700;margin-bottom:2px;}

  /* HEADER */
  .header{background:var(--card);border:1px solid var(--border);border-radius:16px 16px 0 0;padding:16px 20px;display:flex;align-items:center;justify-content:space-between;border-bottom:none;}
  .location{font-family:'Barlow Condensed',sans-serif;font-size:0.75rem;font-weight:600;letter-spacing:0.12em;text-transform:uppercase;color:var(--muted);}
  .location span{color:var(--blue);}
  .score-badge{font-family:'Barlow Condensed',sans-serif;font-size:0.7rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;padding:5px 12px;border-radius:20px;background:rgba(102,187,106,0.15);color:var(--green);border:1px solid rgba(102,187,106,0.3);}
  .score-badge.warn{background:rgba(255,167,38,0.15);color:var(--orange);border-color:rgba(255,167,38,0.3);}
  .score-badge.bad{background:rgba(239,83,80,0.15);color:var(--red);border-color:rgba(239,83,80,0.3);}

  /* TEMP */
  .main-block{background:var(--card);border-left:1px solid var(--border);border-right:1px solid var(--border);padding:8px 20px 16px;display:flex;align-items:flex-end;gap:20px;}
  .temp-now{font-family:'Barlow Condensed',sans-serif;font-size:5rem;font-weight:800;line-height:1;}
  .temp-now sup{font-size:2rem;font-weight:400;opacity:0.6;vertical-align:super;}
  .temp-feels{font-size:0.85rem;color:var(--muted);padding-bottom:6px;}
  .temp-feels strong{color:var(--text);}
  .weather-desc{font-size:0.9rem;color:var(--blue);font-weight:500;text-transform:capitalize;margin-top:4px;}

  /* STATS 3 colonnes */
  .stats{background:var(--card);border-left:1px solid var(--border);border-right:1px solid var(--border);padding:0 12px 12px;display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;}
  .stat-card{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:12px 10px;}
  .stat-label{font-family:'Barlow Condensed',sans-serif;font-size:0.6rem;font-weight:700;letter-spacing:0.12em;text-transform:uppercase;color:var(--muted);margin-bottom:8px;}
  .stat-value{font-family:'Barlow Condensed',sans-serif;font-size:1.5rem;font-weight:700;line-height:1;}
  .stat-unit{font-size:0.75rem;font-weight:400;color:var(--muted);margin-left:2px;}
  .stat-sub{font-size:0.7rem;color:var(--muted);margin-top:4px;}
  .wind-row{display:flex;align-items:center;gap:8px;margin-top:2px;}
  .arrow-wrap{width:32px;height:32px;border-radius:50%;background:rgba(79,195,247,0.1);border:1px solid rgba(79,195,247,0.2);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
  .arrow-icon{font-size:1rem;color:var(--blue);display:inline-block;}

  /* IA COMMENT */
  .ai-block{background:var(--card);border-left:1px solid var(--border);border-right:1px solid var(--border);border-top:1px solid var(--border);padding:12px 16px;}
  .ai-inner{background:rgba(79,195,247,0.05);border:1px solid rgba(79,195,247,0.15);border-radius:12px;padding:12px 14px;display:flex;gap:10px;align-items:flex-start;}
  .ai-icon{font-size:1.2rem;flex-shrink:0;}
  .ai-text{font-size:0.82rem;line-height:1.5;color:var(--text);font-style:italic;}
  .ai-loading{color:var(--muted);font-size:0.78rem;}

  /* SECTION HEADER */
  .section-header{background:var(--card);border-left:1px solid var(--border);border-right:1px solid var(--border);border-top:1px solid var(--border);padding:10px 20px 8px;}
  .section-title{font-family:'Barlow Condensed',sans-serif;font-size:0.65rem;font-weight:700;letter-spacing:0.14em;text-transform:uppercase;color:var(--muted);}

  /* HORAIRE */
  .hourly-scroll{background:var(--card);border-left:1px solid var(--border);border-right:1px solid var(--border);padding:0 12px 12px;overflow-x:auto;scrollbar-width:thin;}
  .hourly-track{display:flex;gap:8px;min-width:max-content;}
  .hour-card{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:10px 10px;text-align:center;min-width:72px;}
  .hour-card.now{border-color:rgba(79,195,247,0.5);background:rgba(79,195,247,0.06);}
  .hour-time{font-family:'Barlow Condensed',sans-serif;font-size:0.7rem;font-weight:600;color:var(--muted);margin-bottom:5px;}
  .hour-card.now .hour-time{color:var(--blue);}
  .hour-temp{font-family:'Barlow Condensed',sans-serif;font-size:1.1rem;font-weight:700;line-height:1;}
  .hour-wind{font-size:0.68rem;color:var(--muted);margin-top:3px;}
  .hour-wind span{color:var(--blue);font-weight:600;}
  .hour-gust{font-size:0.65rem;color:var(--orange);margin-top:1px;}
  .hour-rain{font-size:0.68rem;color:var(--muted);margin-top:2px;}
  .hour-rain.wet{color:#64b5f6;}

  /* DEMAIN */
  .tomorrow-block{background:var(--card);border-left:1px solid var(--border);border-right:1px solid var(--border);padding:0 12px 12px;}
  .tomorrow-card{background:var(--card2);border:1px solid var(--border);border-radius:12px;padding:16px 16px;}
  .tmr-top{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;}
  .tmr-title{display:flex;align-items:center;gap:8px;}
  .tmr-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
  .tmr-dot.good{background:var(--green);box-shadow:0 0 8px var(--green);}
  .tmr-dot.warn{background:var(--orange);box-shadow:0 0 8px var(--orange);}
  .tmr-dot.bad{background:var(--red);box-shadow:0 0 8px var(--red);}
  .tmr-name{font-family:'Barlow Condensed',sans-serif;font-size:1.05rem;font-weight:700;text-transform:uppercase;letter-spacing:0.06em;}
  .tmr-score{font-family:'Barlow Condensed',sans-serif;font-size:0.68rem;font-weight:700;letter-spacing:0.08em;text-transform:uppercase;padding:4px 10px;border-radius:20px;}
  .tmr-score.good{background:rgba(102,187,106,0.15);color:var(--green);border:1px solid rgba(102,187,106,0.3);}
  .tmr-score.warn{background:rgba(255,167,38,0.15);color:var(--orange);border:1px solid rgba(255,167,38,0.3);}
  .tmr-score.bad{background:rgba(239,83,80,0.15);color:var(--red);border:1px solid rgba(239,83,80,0.3);}
  .tmr-desc{font-size:0.82rem;color:var(--muted);margin-bottom:12px;}
  .tmr-grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:8px;}
  .tmr-stat{text-align:center;}
  .tmr-stat-label{font-family:'Barlow Condensed',sans-serif;font-size:0.58rem;font-weight:700;letter-spacing:0.1em;text-transform:uppercase;color:var(--muted);margin-bottom:4px;}
  .tmr-stat-val{font-family:'Barlow Condensed',sans-serif;font-size:1.15rem;font-weight:700;line-height:1;}
  .tmr-stat-sub{font-size:0.65rem;color:var(--muted);margin-top:2px;}

  /* FOOTER */
  .footer{background:var(--card);border:1px solid var(--border);border-radius:0 0 16px 16px;border-top:none;padding:10px 20px;display:flex;justify-content:space-between;align-items:center;}
  .update-time{font-size:0.7rem;color:var(--muted);}
  .advice{font-size:0.75rem;font-weight:500;color:var(--green);}
  .advice.warn{color:var(--orange);}
  .advice.bad{color:var(--red);}

  .loading-state{text-align:center;padding:40px;font-family:'Barlow Condensed',sans-serif;font-size:1rem;letter-spacing:0.1em;color:var(--muted);background:var(--card);border-radius:16px;border:1px solid var(--border);}
  @keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}
  .loading-dot{animation:pulse 1.4s infinite;}
  .loading-dot:nth-child(2){animation-delay:0.2s;}
  .loading-dot:nth-child(3){animation-delay:0.4s;}
</style>
</head>
<body>
<div id="alert-container"></div>
<div class="widget" id="widget-meteo">
  <div class="loading-state">
    <span class="loading-dot">‚óè</span> <span class="loading-dot">‚óè</span> <span class="loading-dot">‚óè</span>
    <div style="margin-top:10px;font-size:0.8rem;">Chargement m√©t√©o...</div>
  </div>
</div>

<script>
(function(){
  var LAT=48.8561, LON=2.8931, CITY="Magny-le-Hongre", DEP="77";
  var DIRS=["N","NNE","NE","ENE","E","ESE","SE","SSE","S","SSO","SO","OSO","O","ONO","NO","NNO"];
  var JOURS=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"];

  function dir(d){return DIRS[Math.round(d/22.5)%16];}

  function getScore(temp,wind,gust,rain,feels){
    var s=100;
    if(temp<5)s-=30; else if(temp<10)s-=15; else if(temp>35)s-=20;
    if(wind>50)s-=35; else if(wind>35)s-=20; else if(wind>25)s-=10;
    if(gust>70)s-=20; else if(gust>50)s-=10;
    if(rain>5)s-=40; else if(rain>2)s-=25; else if(rain>0)s-=10;
    if(feels<3)s-=15;
    return s>=75?"good":s>=45?"warn":"bad";
  }

  function scoreTxt(c){return c==="good"?"‚úì Id√©al pour rouler":c==="warn"?"‚ö† Conditions correctes":"‚úó D√©conseill√©";}

  function wdesc(code){
    var m={0:"Ciel d√©gag√©",1:"Peu nuageux",2:"Partiellement nuageux",3:"Couvert",
      45:"Brouillard",48:"Brouillard givrant",51:"Bruine l√©g√®re",53:"Bruine mod√©r√©e",55:"Bruine dense",
      61:"Pluie l√©g√®re",63:"Pluie mod√©r√©e",65:"Forte pluie",71:"Neige l√©g√®re",73:"Neige mod√©r√©e",75:"Forte neige",
      80:"Averses l√©g√®res",81:"Averses",82:"Fortes averses",95:"Orage",96:"Orage avec gr√™le",99:"Orage violent"};
    return m[code]||"Variable";
  }

  function fmtH(iso){return new Date(iso).getHours().toString().padStart(2,'0')+"h";}

  /* ===================== ALERTES M√âT√âO FRANCE ===================== */
  function loadAlertes(){
    // API Open Data IDF - vigilance d√©partement 77
    var url="https://data.iledefrance.fr/api/explore/v2.1/catalog/datasets/meteo-vigilance-niveau-departemental-idf/records?where=dep_code%3D%2277%22&limit=20&order_by=echeance_debut%20desc";
    fetch(url)
      .then(function(r){return r.json();})
      .then(function(data){
        var alertContainer=document.getElementById("alert-container");
        if(!data.results||data.results.length===0){
          alertContainer.innerHTML='<div class="alert-bar vert"><span class="alert-icon">‚úÖ</span><div class="alert-text"><b>Pas de vigilance m√©t√©o</b>Aucune alerte en cours pour la Seine-et-Marne (77)</div></div>';
          return;
        }
        // Filtrer alertes actives (niveau > 1 = vert)
        var actives=data.results.filter(function(r){return r.niveau_alerte_code&&r.niveau_alerte_code>1;});
        if(actives.length===0){
          alertContainer.innerHTML='<div class="alert-bar vert"><span class="alert-icon">‚úÖ</span><div class="alert-text"><b>Aucune vigilance active</b>D√©partement 77 en vert ‚Äî conditions normales</div></div>';
          return;
        }
        var html="";
        var niveauMap={2:"jaune",3:"orange",4:"rouge"};
        var iconMap={2:"‚ö†Ô∏è",3:"üî∂",4:"üî¥"};
        actives.forEach(function(a){
          var cls=niveauMap[a.niveau_alerte_code]||"jaune";
          var icon=iconMap[a.niveau_alerte_code]||"‚ö†Ô∏è";
          var pheno=a.phenomene_libelle||a.type_vigilance||"Vigilance m√©t√©o";
          var niv=a.niveau_alerte_libelle||("Niveau "+a.niveau_alerte_code);
          html+='<div class="alert-bar '+cls+'"><span class="alert-icon">'+icon+'</span><div class="alert-text"><b>Vigilance '+cls.toUpperCase()+' ‚Äì '+pheno+'</b>'+niv+' ¬∑ Seine-et-Marne (77)</div></div>';
        });
        alertContainer.innerHTML=html;
      })
      .catch(function(){
        // Silencieux si l'API est indisponible
        document.getElementById("alert-container").innerHTML='';
      });
  }

  /* ===================== COMMENTAIRE IA ===================== */
  function loadAIComment(temp,feels,wind,gust,rain,wcode,sc){
    var aiDiv=document.getElementById("ai-comment");
    if(!aiDiv)return;
    aiDiv.innerHTML='<span class="ai-loading">‚è≥ Analyse en cours...</span>';

    var prompt="Tu es un assistant m√©t√©o expert pour cyclistes (route et VTT). "
      +"Voici les conditions actuelles √† Magny-le-Hongre (77) : "
      +"Temp√©rature "+temp+"¬∞C (ressenti "+feels+"¬∞C), "
      +"vent "+wind+" km/h avec rafales √† "+gust+" km/h, "
      +"pr√©cipitations "+rain+" mm/h, "
      +"m√©t√©o : "+wdesc(wcode)+". "
      +"Donne un commentaire court (2-3 phrases max) et pratique pour un cycliste qui veut sortir. "
      +"Mentionne les risques sp√©cifiques si n√©cessaire (rafales, sol mouill√©, visibilit√©). "
      +"Sois direct, concis et utile. R√©ponds en fran√ßais.";

    fetch("https://api.anthropic.com/v1/messages",{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({
        model:"claude-sonnet-4-20250514",
        max_tokens:150,
        messages:[{role:"user",content:prompt}]
      })
    }).then(function(r){return r.json();})
    .then(function(data){
      if(data.content&&data.content[0]&&data.content[0].text){
        aiDiv.innerHTML=data.content[0].text;
      } else {
        aiDiv.innerHTML=generateLocalComment(temp,feels,wind,gust,rain,sc);
      }
    }).catch(function(){
      aiDiv.innerHTML=generateLocalComment(temp,feels,wind,gust,rain,sc);
    });
  }

  // Fallback si l'API IA n'est pas disponible
  function generateLocalComment(temp,feels,wind,gust,rain,sc){
    var parts=[];
    if(sc==="good"){
      parts.push("Les conditions sont favorables pour une sortie v√©lo.");
    } else if(sc==="warn"){
      parts.push("Les conditions sont acceptables mais n√©cessitent de la prudence.");
    } else {
      parts.push("Les conditions sont difficiles, la sortie est d√©conseill√©e.");
    }
    if(gust>50) parts.push("Attention aux rafales √† "+gust+" km/h pouvant d√©stabiliser le v√©lo.");
    else if(gust>35) parts.push("Des rafales √† "+gust+" km/h sont possibles, soyez vigilant dans les zones expos√©es.");
    if(rain>0) parts.push("Sol mouill√©, adaptez votre freinage.");
    if(temp<8) parts.push("Temp√©rature froide ("+temp+"¬∞C), √©quipement thermique recommand√©.");
    return parts.join(" ");
  }

  /* ===================== M√âT√âO PRINCIPALE ===================== */
  function load(){
    fetch("https://api.open-meteo.com/v1/forecast"
      +"?latitude="+LAT+"&longitude="+LON
      +"&current=temperature_2m,apparent_temperature,precipitation,wind_speed_10m,wind_gusts_10m,wind_direction_10m,weathercode"
      +"&hourly=temperature_2m,precipitation,wind_speed_10m,wind_gusts_10m,wind_direction_10m"
      +"&daily=temperature_2m_max,temperature_2m_min,precipitation_sum,wind_speed_10m_max,wind_gusts_10m_max,wind_direction_10m_dominant,weathercode"
      +"&wind_speed_unit=kmh&timezone=Europe%2FParis&forecast_days=3"
    ).then(function(r){if(!r.ok)throw new Error("HTTP "+r.status);return r.json();})
    .then(function(d){

      var c=d.current;
      var temp=Math.round(c.temperature_2m);
      var feels=Math.round(c.apparent_temperature);
      var wind=Math.round(c.wind_speed_10m);
      var gust=Math.round(c.wind_gusts_10m||wind);
      var wdeg=c.wind_direction_10m||0;
      var rain=c.precipitation||0;
      var wcode=c.weathercode||0;
      var sc=getScore(temp,wind,gust,rain,feels);
      var rainTxt=rain===0?"Pas de pluie":rain<1?"Bruine":rain<3?"Pluie mod√©r√©e":"Forte pluie";
      var advTxt=sc==="good"?"üö¥ Route & VTT OK":sc==="warn"?"‚ö° √âquipez-vous bien":"üè† Restez au chaud";
      var timeStr=new Date().toLocaleTimeString("fr-FR",{hour:"2-digit",minute:"2-digit"});

      /* HORAIRE 12h */
      var now=new Date(), times=d.hourly.time, si=0;
      for(var i=0;i<times.length;i++){if(new Date(times[i])>=now){si=i;break;}}
      var hhtml="";
      for(var i=si;i<si+12&&i<times.length;i++){
        var isN=i===si;
        var ht=Math.round(d.hourly.temperature_2m[i]);
        var hw=Math.round(d.hourly.wind_speed_10m[i]);
        var hg=Math.round(d.hourly.wind_gusts_10m[i]||hw);
        var hr=d.hourly.precipitation[i]||0;
        var hd=dir(d.hourly.wind_direction_10m[i]||0);
        hhtml+='<div class="hour-card'+(isN?" now":"")+'"><div class="hour-time">'+(isN?"Maint.":fmtH(times[i]))+'</div>'
          +'<div class="hour-temp">'+ht+'¬∞</div>'
          +'<div class="hour-wind"><span>'+hw+'</span> km/h '+hd+'</div>'
          +(hg>hw+5?'<div class="hour-gust">‚Üë '+hg+' km/h</div>':'')
          +'<div class="hour-rain'+(hr>0?" wet":"")+'">'+( hr>0?"üåß "+hr.toFixed(1):"‚Äî mm")+'</div></div>';
      }

      /* DEMAIN */
      var dd=d.daily;
      var p=dd.time[1].split("-");
      var dt=new Date(parseInt(p[0]),parseInt(p[1])-1,parseInt(p[2]));
      var dname=JOURS[dt.getDay()]+" "+dt.getDate()+"/"+(dt.getMonth()+1);
      var dmax=Math.round(dd.temperature_2m_max[1]);
      var dmin=Math.round(dd.temperature_2m_min[1]);
      var dw=Math.round(dd.wind_speed_10m_max[1]);
      var dg=Math.round(dd.wind_gusts_10m_max[1]||dw);
      var ddir=dir(dd.wind_direction_10m_dominant[1]||0);
      var dr=dd.precipitation_sum[1]||0;
      var dsc=getScore(dmax,dw,dg,dr,dmin);

      /* RENDU */
      document.getElementById("widget-meteo").innerHTML=
        '<div class="header">'
          +'<div class="location">üìç <span>'+CITY+'</span> ¬∑ Seine-et-Marne</div>'
          +'<div class="score-badge '+sc+'">'+scoreTxt(sc)+'</div>'
        +'</div>'

        +'<div class="main-block">'
          +'<div class="temp-now">'+temp+'<sup>¬∞C</sup></div>'
          +'<div>'
            +'<div class="temp-feels">Ressenti <strong>'+feels+'¬∞C</strong></div>'
            +'<div class="weather-desc">'+wdesc(wcode)+'</div>'
          +'</div>'
        +'</div>'

        +'<div class="stats">'
          +'<div class="stat-card">'
            +'<div class="stat-label">Vent ¬∑ vient du</div>'
            +'<div class="wind-row">'
              +'<div class="arrow-wrap"><span class="arrow-icon" style="display:inline-block;transform:rotate('+(wdeg+180)+'deg)">‚Üë</span></div>'
              +'<div><div class="stat-value">'+wind+'<span class="stat-unit">km/h</span></div>'
              +'<div class="stat-sub">'+dir(wdeg)+'</div></div>'
            +'</div>'
          +'</div>'
          +'<div class="stat-card">'
            +'<div class="stat-label">Rafales</div>'
            +'<div class="stat-value" style="color:'+(gust>50?"var(--red)":gust>35?"var(--orange)":"var(--text)")+'">'+gust+'<span class="stat-unit">km/h</span></div>'
            +'<div class="stat-sub">'+(gust>50?"‚ö† Dangereuses":gust>35?"‚ö° Fortes":"Normal")+'</div>'
          +'</div>'
          +'<div class="stat-card">'
            +'<div class="stat-label">Pluie (1h)</div>'
            +'<div class="stat-value" style="color:'+(rain>0?"#64b5f6":"var(--text)")+'">'+rain.toFixed(1)+'<span class="stat-unit">mm</span></div>'
            +'<div class="stat-sub">'+rainTxt+'</div>'
          +'</div>'
        +'</div>'

        +'<div class="ai-block">'
          +'<div class="ai-inner">'
            +'<span class="ai-icon">ü§ñ</span>'
            +'<div class="ai-text" id="ai-comment"><span class="ai-loading">‚è≥ Analyse IA en cours...</span></div>'
          +'</div>'
        +'</div>'

        +'<div class="section-header"><div class="section-title">‚è± Pr√©visions ¬∑ 12 prochaines heures</div></div>'
        +'<div class="hourly-scroll"><div class="hourly-track">'+hhtml+'</div></div>'

        +'<div class="section-header"><div class="section-title">üìÖ Demain ¬∑ '+dname+'</div></div>'
        +'<div class="tomorrow-block">'
          +'<div class="tomorrow-card">'
            +'<div class="tmr-top">'
              +'<div class="tmr-title"><div class="tmr-dot '+dsc+'"></div><div class="tmr-name">'+dname+'</div></div>'
              +'<div class="tmr-score '+dsc+'">'+scoreTxt(dsc)+'</div>'
            +'</div>'
            +'<div class="tmr-desc">'+wdesc(dd.weathercode[1]||0)+'</div>'
            +'<div class="tmr-grid">'
              +'<div class="tmr-stat"><div class="tmr-stat-label">Temp max</div><div class="tmr-stat-val">'+dmax+'¬∞</div><div class="tmr-stat-sub">min '+dmin+'¬∞</div></div>'
              +'<div class="tmr-stat"><div class="tmr-stat-label">Vent</div><div class="tmr-stat-val" style="color:var(--blue)">'+dw+'</div><div class="tmr-stat-sub">km/h '+ddir+'</div></div>'
              +'<div class="tmr-stat"><div class="tmr-stat-label">Rafales</div><div class="tmr-stat-val" style="color:'+(dg>50?"var(--red)":dg>35?"var(--orange)":"var(--text)")+'">'+dg+'</div><div class="tmr-stat-sub">km/h</div></div>'
              +'<div class="tmr-stat"><div class="tmr-stat-label">Pluie</div><div class="tmr-stat-val" style="color:'+(dr>0?"#64b5f6":"var(--text)")+'">'+dr.toFixed(1)+'</div><div class="tmr-stat-sub">mm '+(dr>0?"üåß":"‚òÄ")+'</div></div>'
            +'</div>'
          +'</div>'
        +'</div>'

        +'<div class="footer">'
          +'<div class="update-time">Mise √† jour : '+timeStr+'</div>'
          +'<div class="advice '+sc+'">'+advTxt+'</div>'
        +'</div>';

      // Charger le commentaire IA
      loadAIComment(temp,feels,wind,gust,rain,wcode,sc);

    }).catch(function(e){
      document.getElementById("widget-meteo").innerHTML=
        '<div class="loading-state"><div style="color:#ef5350">Erreur de chargement</div>'
        +'<div style="font-size:0.75rem;margin-top:8px;color:var(--muted)">'+e.message+'</div></div>';
    });
  }

  // Lancement
  loadAlertes();
  load();
  setInterval(function(){loadAlertes();load();},600000);
})();
</script>
</body>
</html>
